# E04

## Rappels MCD-MLD-MPD

### MCD : Mod√®le Conceptuel de Donn√©es

l'objectif du MCD est de communiquer avec notre client, on utilisera donc pas de terme technique.

Nos objectifs sont:

* de mettre en relation des entit√©s, on va donc construire des relations.
* de mettre en √©vidence les propri√©t√©s de chaque entit√©
* de cr√©er des cl√©s primaires : Primary Key / PK

Les relations se d√©finissent avec :

* un verbe
* deux cardinalit√©s
  * un cardinalit√© en partant de chaque entit√©

### MLD : Mod√®le Logique de Donn√©es

l'objectif du MLD est d'appliquer les r√®gles de `voyage` des  `Primary Key (PK)` et donc de cr√©er des `Foreign Key (FK)`

#### Cardinalit√©s : Comment positionner les FK ?

J'ai deux tables :

* Movie
* Season

Il y a une relation 0,N de `Movie` vers `Season`
Il y a une relation 1,1 de `Season` vers `Movie`

Un moyen mn√©motechnique de me souvenir o√π va √™tre la cl√© √©trang√®re :
Les cl√©s primaires voyagent ‚úà et elles veulent aller dans le plus d'autres pays (table) possible.
Donc les cl√©s primaires voyagent depuis la table avec la cardinalit√© maximum N vers l'autre table.
La cl√© primaire de `Movie` voyage donc vers la table `Season`, et devient une cl√© √©trang√®re dans cette table.

On appellera √ßa une relation ManyToOne/OneToMany üòâ

Mais comment on fait quand il y a une cardinalit√© max N de chaque cot√© ü§î ?

Repronnons l'id√©e du voyage :

les cl√©s primaires voyagent, se rencontrent sur le chemin, tombent amoureuses üíò, et fondent une nouvelle table. Awwwn ü§ó

On appellera √ßa une relation ManyToMany üòâ

### MPD : Mod√®le Physique de Donn√©es

L'objectif du MPD est de d√©finir toute la partie technique:

* le nom des PK
* les types de chaque donn√©es
* les donn√©es techniques (id, created_at)
* les noms finaux des tout les champs

## SQL

```sql
SELECT * 
FROM movie
```

```sql
SELECT * 
from movie 
ORDER BY movie.title
```

`ORDER BY` par d√©faut c'est `ASC`

```sql
-- tout les genres du film id = 2
SELECT *
FROM genre
INNER JOIN movie_genre ON genre.id = movie_genre.genre_id
WHERE movie_genre.movie_id = 2
```

```sql
-- R√©cup√©rer les saisons associ√©es √† un film/s√©rie donn√© : movie_id = 3
SELECT *
FROM season
WHERE movie_id = 3
```

```sql
-- R√©cup√©rer les critiques pour un film donn√©.
SELECT *
FROM review
WHERE movie_id = 1
```

```sql
-- Calculer, pour un film donn√© , la moyenne des critiques 
SELECT AVG(rating) 
FROM review
where movie_id = 3
```

```sql
-- Calculer, pour chaque film, la moyenne des critiques par film (en une seule requ√™te).
SELECT AVG(rating) , movie_id
FROM review
GROUP BY movie_id
```

```sql
-- Calculer, pour chaque film, la moyenne des critiques par film (en une seule requ√™te).
SELECT AVG(rating) AS rating_avg, movie.title
FROM review
INNER JOIN movie ON review.movie_id = movie.id
GROUP BY movie_id
```

```sql
-- R√©cup√©rer les acteurs et leur(s) r√¥le(s) pour un film donn√©.
SELECT person.*, casting.role, casting.credit_order
FROM person
INNER JOIN casting ON person.id = casting.person_id
WHERE casting.movie_id = 20
```

```sql
-- R√©cup√©rer tous les films pour une ann√©e de sortie donn√©e.
SELECT *, YEAR( release_date )
FROM movie
WHERE YEAR( release_date ) = 2014
```

```sql
-- R√©cup√©rer le nombre de films par ann√©e
SELECT YEAR( release_date ) as annee, COUNT(*) as nombre
FROM movie
GROUP BY annee
ORDER BY nombre DESC
```

```sql
-- R√©cup√©rer tous les films dont le titre contient une cha√Æne donn√©e.
SELECT *
FROM movie
WHERE title LIKE '%ra%'
```

```sql
-- R√©cup√©rer la liste des films de la page 2 (gr√¢ce √† LIMIT).
-- pagination : page 1
SELECT *
FROM movie
LIMIT 10;
-- pagination : page 2
SELECT *
FROM movie
LIMIT 10, 10;
-- pagination : page 4 (LIMIT = 10 * (numero page - 1))
SELECT *
FROM movie
LIMIT 30, 10;
```

```php
$nombreResultatParPage = 10; // donn√© par l'utilisateur via un formulaire (liste d√©roulante)
$numeroPage = 2; // donn√© par l'utilisateur dans la route

$limit = $nombreResultatParPage * ($numeroPage -1);

$sql = 'SELECT * FROM movie LIMIT ' . $limit . ', ' . $nombreResultatParPage . ';';
```
